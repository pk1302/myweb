import React, { useEffect, useState } from "react";
import axios from "axios";
import { Line } from "react-chartjs-2";
import "chart.js/auto";

export default function StockMarket() {
  const [stockData, setStockData] = useState(null);
  const [symbol, setSymbol] = useState("AAPL");

  useEffect(() => {
    fetchStockData(symbol);
  }, [symbol]);

  const fetchStockData = async (symbol) => {
    const API_KEY = "8SRCOC2NZNSLW6W4"; // Your actual API key
    const url = `https://www.alphavantage.co/query?function=TIME_SERIES_DAILY&symbol=${symbol}&apikey=${API_KEY}`;
    
    try {
      const response = await axios.get(url);
      const data = response.data["Time Series (Daily)"];
      if (data) {
        const dates = Object.keys(data).slice(0, 10).reverse();
        const prices = dates.map((date) => data[date]["4. close"]);

        setStockData({
          labels: dates,
          datasets: [
            {
              label: `${symbol} Stock Price`,
              data: prices,
              borderColor: "#3e95cd",
              fill: false,
            },
          ],
        });
      }
    } catch (error) {
      console.error("Error fetching stock data:", error);
    }
  };

  return (
    <div className="container mx-auto p-6">
      <h1 className="text-3xl font-bold text-center">Stock Market Analysis</h1>
      <div className="flex justify-center my-4">
        <input
          type="text"
          placeholder="Enter stock symbol (e.g., AAPL)"
          className="border p-2 rounded"
          onChange={(e) => setSymbol(e.target.value.toUpperCase())}
        />
      </div>
      {stockData ? <Line data={stockData} /> : <p>Loading stock data...</p>}
    </div>
  );
}
