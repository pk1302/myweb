<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Possible Studio Booking (UPI QR Only)</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;900&display=swap" rel="stylesheet">
  <style>body { font-family: 'Inter', sans-serif; }</style>
  <!-- Firebase compat SDKs -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
  <!-- React UMD -->
  <script src="https://unpkg.com/react@17/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@17/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/react-router-dom@5.3.4/umd/react-router-dom.min.js"></script>
</head>
<body class="bg-zinc-900 text-white">
  <div id="root"></div>
  <!-- Notification sound for admin panel -->
  <audio id="notif-sound" src="https://cdn.pixabay.com/audio/2022/07/26/audio_124bfa1c82.mp3" preload="auto"></audio>
  <script>
    // --- Firebase Config ---
    const firebaseConfig = {
      apiKey: "AIzaSyCzSeK0Mare4CtM4pFqwSAO_YmLcQEGJOo",
      authDomain: "studio-booking-608cc.firebaseapp.com",
      databaseURL: "https://studio-booking-608cc-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "studio-booking-608cc",
      storageBucket: "studio-booking-608cc.appspot.com",
      messagingSenderId: "464295194306",
      appId: "1:464295194306:web:d8ec45509b0e4241a9955b",
      measurementId: "G-LZEK0QJBMG"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    const { useState, useEffect, useMemo, useCallback } = React;
    const { HashRouter, Route, Switch, Link, useHistory, Redirect, useLocation } = ReactRouterDOM;

    // --- Booking CRUD with Firebase ---
    function createBooking(booking) {
      return db.ref('bookings').push(booking);
    }
    function updateBooking(id, updates) {
      return db.ref('bookings/' + id).update(updates);
    }
    function listenBookings(callback) {
      const ref = db.ref('bookings');
      ref.on('value', snapshot => {
        const val = snapshot.val() || {};
        const bookings = Object.entries(val).map(([id, data]) => ({ id, ...data }));
        callback(bookings);
      });
      return () => ref.off();
    }

    // --- UI Data ---
    const PRICING_PLANS = [
      { id: 'basic', name: 'Basic Studio', price: 2000, description: 'Just the space. Bring your own gear and create freely.', features: ['Studio Space Access'] },
      { id: 'standard', name: 'Standard Package', price: 3500, description: 'A complete setup for most projects, cameraman included.', features: ['Studio Space Access', '2 Professional Cameras', 'Standard Lighting Kit', '2 Shure Microphones', 'Dedicated Cameraman'] },
      { id: 'premium', name: 'Premium Package', price: 4500, description: 'For complex shoots requiring multiple angles and full support.', features: ['Studio Space Access', '3 Professional Cameras', 'Advanced Lighting Kit', '2 Shure Microphones', 'Dedicated Cameraman'] },
    ];
    const HOURLY_SLOTS = Array.from({ length: 14 }, (_, i) => {
      const hour = i + 9;
      return `${hour < 10 ? '0' : ''}${hour}:00`;
    });

    // --- BookingForm ---
    function BookingForm({ plan, onCancel }) {
      const [date, setDate] = useState(new Date().toISOString().split('T')[0]);
      const [startTime, setStartTime] = useState('');
      const [endTime, setEndTime] = useState('');
      const [paymentOption, setPaymentOption] = useState('full');
      const [name, setName] = useState('');
      const [phone, setPhone] = useState('');
      const [formError, setFormError] = useState('');
      const [bookings, setBookings] = useState([]);

      useEffect(() => listenBookings(setBookings), []);

      const getUnavailableHours = useCallback((date) => {
        const dayBookings = bookings.filter(b => b.date === date && b.status === 'confirmed');
        let hours = [];
        dayBookings.forEach(b => {
          const start = parseInt(b.startTime.split(':')[0], 10);
          const end = parseInt(b.endTime.split(':')[0], 10);
          for (let h = start; h < end; h++) hours.push(h);
        });
        return hours;
      }, [bookings]);
      const unavailableHours = useMemo(() => getUnavailableHours(date), [date, getUnavailableHours]);
      const startTimes = useMemo(() => HOURLY_SLOTS.slice(0, -1).map(time => ({ value: time, disabled: unavailableHours.includes(parseInt(time.split(':')[0], 10)) })), [unavailableHours]);
      const endTimes = useMemo(() => {
        if (!startTime) return [];
        const startHour = parseInt(startTime.split(':')[0], 10);
        let nextUnavailableHour = 23;
        for (const hour of unavailableHours.sort((a,b) => a - b)) { if (hour > startHour) { nextUnavailableHour = hour; break; } }
        return HOURLY_SLOTS.map(time => parseInt(time.split(':')[0], 10)).filter(hour => hour > startHour && hour <= nextUnavailableHour).map(hour => ({ value: `${hour < 10 ? '0' : ''}${hour}:00` }));
      }, [startTime, unavailableHours]);
      const duration = useMemo(() => {
        if (!startTime || !endTime) return 0;
        return parseInt(endTime.split(':')[0], 10) - parseInt(startTime.split(':')[0], 10);
      }, [startTime, endTime]);
      const totalAmount = plan.price * duration;
      const paymentAmount = paymentOption === "full" ? totalAmount : Math.ceil(totalAmount / 2);

      function isValidPhone(num) {
        // Only numbers, exactly 10 digits, starts with 6-9 for Indian phones
        return /^[6-9]\d{9}$/.test(num);
      }

      const handleSubmit = (e) => {
        e.preventDefault();
        setFormError('');
        if (!name || !phone || !date || !startTime || !endTime) {
          setFormError('Please fill all fields.');
          return;
        }
        if (!isValidPhone(phone)) {
          setFormError('Enter a valid 10-digit phone number (starts with 6-9).');
          return;
        }
        if (duration <= 0) {
          setFormError('Please select a valid time slot.');
          return;
        }
        // Save booking
        createBooking({
          plan: plan.name,
          date,
          startTime,
          endTime,
          name,
          phone,
          status: "pending",
          createdAt: Date.now()
        });
        alert("Booking submitted! Please wait for admin confirmation.");
        setName('');
        setPhone('');
        setStartTime('');
        setEndTime('');
        setFormError('');
        if (onCancel) onCancel();
      };

      return (
        React.createElement("form", { className: "bg-zinc-800 p-6 rounded-xl mt-8", onSubmit: handleSubmit },
          React.createElement("h3", { className: "text-xl font-bold mb-4" }, `Book: ${plan.name}`),
          React.createElement("label", { className: "block mt-2 mb-1" }, "Date:"),
          React.createElement("input", {
            type: "date",
            className: "w-full rounded-md bg-zinc-900 border border-zinc-700 px-4 py-3 text-lg text-white",
            value: date,
            min: new Date().toISOString().split('T')[0],
            onChange: e => setDate(e.target.value),
            required: true
          }),
          React.createElement("label", { className: "block mt-4 mb-1" }, "Start Time:"),
          React.createElement("select", {
            className: "w-full rounded-md bg-zinc-900 border border-zinc-700 px-4 py-3 text-lg text-white",
            value: startTime,
            onChange: e => setStartTime(e.target.value),
            required: true
          },
            React.createElement("option", { value: "" }, "Select"),
            startTimes.map(opt =>
              React.createElement("option", { key: opt.value, value: opt.value, disabled: opt.disabled }, opt.value + (opt.disabled ? " (unavailable)" : ""))
            )
          ),
          React.createElement("label", { className: "block mt-4 mb-1" }, "End Time:"),
          React.createElement("select", {
            className: "w-full rounded-md bg-zinc-900 border border-zinc-700 px-4 py-3 text-lg text-white",
            value: endTime,
            onChange: e => setEndTime(e.target.value),
            required: true
          },
            React.createElement("option", { value: "" }, "Select"),
            endTimes.map(opt =>
              React.createElement("option", { key: opt.value, value: opt.value }, opt.value)
            )
          ),
          React.createElement("label", { className: "block mt-4 mb-1" }, "Name:"),
          React.createElement("input", {
            type: "text",
            className: "w-full rounded-md bg-zinc-900 border border-zinc-700 px-4 py-3 text-lg text-white",
            value: name,
            onChange: e => setName(e.target.value),
            required: true
          }),
          React.createElement("label", { className: "block mt-4 mb-1" }, "Phone Number:"),
          React.createElement("input", {
            type: "tel",
            className: "w-full rounded-md bg-zinc-900 border border-zinc-700 px-4 py-3 text-lg text-white",
            placeholder: "Your 10-digit phone number",
            value: phone,
            maxLength: 10,
            pattern: "[6-9][0-9]{9}",
            onChange: e => {
              // Only allow digits, max 10
              const val = e.target.value.replace(/\D/g, '').slice(0, 10);
              setPhone(val);
            },
            required: true
          }),
          formError && React.createElement("div", { className: "text-red-400 mt-2" }, formError),
          React.createElement("div", { className: "mt-6 flex space-x-4" },
            React.createElement("button", { type: "submit", className: "bg-yellow-500 text-zinc-900 font-bold py-3 px-6 rounded-lg hover:bg-yellow-600 transition-colors" }, "Book Now"),
            React.createElement("button", { type: "button", onClick: onCancel, className: "bg-zinc-700 text-white font-bold py-3 px-6 rounded-lg hover:bg-zinc-600 transition-colors" }, "Cancel")
          )
        )
      );
    }

    // --- Admin Panel ---
    function AdminPanel() {
      const [bookings, setBookings] = useState([]);
      const [lastBookingIds, setLastBookingIds] = useState([]);

      useEffect(() => {
        return listenBookings(newBookings => {
          // Play sound if a new booking is added
          const newIds = newBookings.map(b => b.id);
          if (lastBookingIds.length && newIds.length > lastBookingIds.length) {
            const audio = document.getElementById('notif-sound');
            if (audio) {
              audio.currentTime = 0;
              audio.play();
            }
          }
          setBookings(newBookings);
          setLastBookingIds(newIds);
        });
      }, [lastBookingIds]);

      return (
        React.createElement("div", { className: "max-w-4xl mx-auto mt-10 p-6 bg-zinc-800 rounded-xl" },
          React.createElement("h2", { className: "text-2xl font-bold mb-4" }, "Admin Panel - Bookings"),
          bookings.length === 0
            ? React.createElement("div", null, "No bookings yet.")
            : React.createElement("table", { className: "w-full text-sm mt-4" },
                React.createElement("thead", null,
                  React.createElement("tr", null,
                    React.createElement("th", { className: "px-2 py-2 text-left" }, "Name"),
                    React.createElement("th", { className: "px-2 py-2 text-left" }, "Phone"),
                    React.createElement("th", { className: "px-2 py-2 text-left" }, "Plan"),
                    React.createElement("th", { className: "px-2 py-2 text-left" }, "Date"),
                    React.createElement("th", { className: "px-2 py-2 text-left" }, "Time"),
                    React.createElement("th", { className: "px-2 py-2 text-left" }, "Status")
                  )
                ),
                React.createElement("tbody", null,
                  bookings.map(b =>
                    React.createElement("tr", { key: b.id, className: "border-t border-zinc-700" },
                      React.createElement("td", { className: "px-2 py-2" }, b.name),
                      React.createElement("td", { className: "px-2 py-2" }, b.phone),
                      React.createElement("td", { className: "px-2 py-2" }, b.plan),
                      React.createElement("td", { className: "px-2 py-2" }, b.date),
                      React.createElement("td", { className: "px-2 py-2" }, b.startTime + " - " + b.endTime),
                      React.createElement("td", { className: "px-2 py-2" }, b.status)
                    )
                  )
                )
              )
        )
      );
    }

    // --- Main App ---
    function App() {
      const [selectedPlan, setSelectedPlan] = useState(null);
      const [admin, setAdmin] = useState(false);

      return (
        React.createElement(HashRouter, null,
          React.createElement("div", null,
            React.createElement("header", { className: "bg-zinc-900 p-4 flex justify-between items-center" },
              React.createElement("h1", { className: "text-2xl font-bold" }, "Possible Studio Booking"),
              React.createElement("nav", null,
                React.createElement(Link, { to: "/", className: "mr-4" }, "Home"),
                React.createElement(Link, { to: "/admin" }, "Admin Panel")
              )
            ),
            React.createElement("main", { className: "container mx-auto px-4" },
              React.createElement(Switch, null,
                React.createElement(Route, { exact: true, path: "/" },
                  selectedPlan
                    ? React.createElement(BookingForm, { plan: selectedPlan, onCancel: () => setSelectedPlan(null) })
                    : React.createElement("div", { className: "mt-10" },
                        React.createElement("h2", { className: "text-3xl font-bold mb-6" }, "Choose a Plan"),
                        React.createElement("div", { className: "grid grid-cols-1 md:grid-cols-3 gap-6" },
                          PRICING_PLANS.map(plan =>
                            React.createElement("div", { key: plan.id, className: "bg-zinc-800 p-6 rounded-xl" },
                              React.createElement("h3", { className: "text-xl font-bold mb-2" }, plan.name),
                              React.createElement("p", { className: "mb-2" }, plan.description),
                              React.createElement("p", { className: "mb-2 text-yellow-400" }, "₹" + plan.price + "/hr"),
                              React.createElement("button", {
                                className: "bg-yellow-500 text-zinc-900 px-4 py-2 rounded hover:bg-yellow-600",
                                onClick: () => setSelectedPlan(plan)
                              }, "Book Now")
                            )
                          )
                        )
                      )
                ),
                React.createElement(Route, { path: "/admin" },
                  React.createElement(AdminPanel, null)
                )
              )
            )
          )
        )
      );
    }

    ReactDOM.render(React.createElement(App), document.getElementById("root"));
  </script>
</body>
</html>
